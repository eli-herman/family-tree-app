---
phase: 01-data-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/stores/feedStore.ts
  - src/types/feed.ts
  - src/utils/mockData.ts
autonomous: true

must_haves:
  truths:
    - "useFeedStore.loadData() populates items array"
    - "useFeedStore.getItemsByAuthor('eli') returns Eli's posts"
    - "useFeedStore.getComments(itemId) returns comments array"
    - "Feed items have comments array"
  artifacts:
    - path: "src/stores/feedStore.ts"
      provides: "Enhanced feed store with async loading and selectors"
      exports: ["useFeedStore"]
    - path: "src/types/feed.ts"
      provides: "FeedItem type with comments"
      contains: "comments"
  key_links:
    - from: "src/stores/feedStore.ts"
      to: "src/utils/mockData.ts"
      via: "imports mockFeedItems"
      pattern: "import.*mockFeedItems.*from.*mockData"
---

<objective>
Enhance feedStore with async loading, comments support, and new selectors.

Purpose: Update the existing feedStore to follow the async loadData() pattern and add selectors needed for feed interactions (Phase 5).
Output: Enhanced feedStore with loading states, comments support, and new selectors.
</objective>

<execution_context>
@./.claude/agents/workflows/execute-plan.md
@./.claude/agents/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-data-foundation/01-CONTEXT.md
@.planning/phases/01-data-foundation/01-RESEARCH.md
@src/stores/feedStore.ts
@src/types/feed.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Comment type and comments to FeedItem</name>
  <files>src/types/feed.ts</files>
  <action>
Add Comment interface and comments array to FeedItem.

**Add Comment interface:**
```typescript
export interface Comment {
  id: string;
  authorId: string;
  authorName: string;
  authorPhotoURL?: string;
  text: string;
  createdAt: Date;
}
```

**Update FeedItem interface:**
Add `comments: Comment[]` field to FeedItem interface.

Keep all existing fields (id, type, authorId, authorName, etc.).
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Comment type exists and FeedItem has comments array</done>
</task>

<task type="auto">
  <name>Task 2: Enhance feedStore with async loading and selectors</name>
  <files>src/stores/feedStore.ts</files>
  <action>
Update the existing feedStore to add async loading and new selectors.

**Updated state interface:**
```typescript
interface FeedState {
  items: FeedItem[];
  isLoading: boolean;
  error: string | null;

  // Existing actions
  setItems: (items: FeedItem[]) => void;
  addItem: (item: FeedItem) => void;
  updateItem: (id: string, updates: Partial<FeedItem>) => void;
  removeItem: (id: string) => void;
  setLoading: (loading: boolean) => void;
  toggleHeart: (itemId: string, userId: string) => void;

  // NEW: Async loading
  loadData: () => Promise<void>;

  // NEW: Selectors
  getItemsByAuthor: (memberId: string) => FeedItem[];
  getComments: (itemId: string) => Comment[];
  getItemById: (itemId: string) => FeedItem | undefined;
}
```

**loadData implementation:**
- Set isLoading: true, error: null
- Simulate async with 100ms delay
- Import mockFeedItems from mockData.ts
- Set items to mockFeedItems
- Set isLoading: false on success
- Catch errors and set error message

**getItemsByAuthor implementation:**
```typescript
getItemsByAuthor: (memberId) => get().items.filter(item => item.authorId === memberId)
```

**getComments implementation:**
```typescript
getComments: (itemId) => {
  const item = get().items.find(i => i.id === itemId);
  return item?.comments || [];
}
```

**getItemById implementation:**
```typescript
getItemById: (itemId) => get().items.find(i => i.id === itemId)
```

**Keep existing actions** - they already work correctly (toggleHeart is optimistic).

**Add error state** if not already present (error: string | null).
  </action>
  <verify>
```typescript
const store = useFeedStore.getState();
await store.loadData();
console.log(store.items.length); // Should be > 0
console.log(store.getItemsByAuthor('shelby').length); // Should return Shelby's posts
```
  </verify>
  <done>feedStore has loadData action and getItemsByAuthor, getComments, getItemById selectors</done>
</task>

<task type="auto">
  <name>Task 3: Update mockFeedItems with comments</name>
  <files>src/utils/mockData.ts</files>
  <action>
Update the mockFeedItems in mockData.ts to include comments arrays.

**Important:** Do NOT modify mockFamilyMembers or mockPrompts. Only add comments arrays to existing mockFeedItems.

**Add comments to each feed item:**
- Most items: 1-3 comments from different family members
- Some items: empty comments array (for variety)
- Use Herman family member IDs as comment authors

**Example comment structure:**
```typescript
comments: [
  {
    id: 'comment-1',
    authorId: 'shelby',
    authorName: 'Shelby Herman',
    authorPhotoURL: 'https://i.pravatar.cc/150?img=5',
    text: 'Love this memory!',
    createdAt: new Date('2026-01-16T09:00:00'),
  },
]
```

**Distribution:**
- Grandparents (Peggy, Ron) leave thoughtful comments
- Parents (Shelby, Timothy) leave supportive comments
- Siblings (Ella, Bennett, Ember) leave casual comments
- Eli's posts should have family engagement

This provides test data for the comment view feature in Phase 5.
  </action>
  <verify>
```typescript
const item = mockFeedItems[0];
console.log(item.comments.length); // Should be > 0 for most items
```
  </verify>
  <done>mockFeedItems include comments arrays with Herman family member comments</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `npx tsc --noEmit` - no TypeScript errors
2. Import useFeedStore from '@/stores'
3. Call loadData()
4. Verify items have comments arrays
5. Verify getItemsByAuthor returns filtered items
6. Verify getComments returns comments for an item
</verification>

<success_criteria>
- Comment type defined in feed.ts
- FeedItem has comments: Comment[] field
- feedStore has loadData(), getItemsByAuthor(), getComments(), getItemById()
- feedStore has error state
- mockFeedItems have sample comments from Herman family members
</success_criteria>

<output>
After completion, create `.planning/phases/01-data-foundation/01-03-SUMMARY.md`
</output>
